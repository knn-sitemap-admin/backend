<div class="auth">
    <div class="auth__panel">
        <div class="auth__head">
            <div class="auth__title">OWNER LOGIN</div>
            <div class="auth__sub">관리자 계정으로 로그인</div>
        </div>

        <form class="form" id="login-form">
            <label class="field">
                <div class="field__label">Email</div>
                <input class="input" type="email" name="email" placeholder="admin@company.com" autocomplete="username" required />
            </label>

            <label class="field">
                <div class="field__label">Password</div>
                <input class="input" type="password" name="password" placeholder="••••••••" autocomplete="current-password" required />
            </label>

            <div class="row">
                <button class="btn btn--primary" type="submit">로그인</button>
                <a class="btn btn--ghost" href="/owner/reset-password">비밀번호 변경</a>
            </div>

            <div class="hint">
                최초 1회 관리자 생성이 필요하면
                <a class="link" href="/owner/bootstrap-admin">부트스트랩 페이지</a>를 사용하세요.
            </div>
        </form>

        <div class="toast" id="toast" aria-hidden="true"></div>
    </div>
</div>

<script>
    (function () {
        const form = document.getElementById('login-form');
        const toast = document.getElementById('toast');

        function showToast(msg) {
            toast.textContent = msg;
            toast.setAttribute('aria-hidden', 'false');
            toast.classList.add('is-open');
            setTimeout(() => toast.classList.remove('is-open'), 2200);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const fd = new FormData(form);
            const email = String(fd.get('email') || '');
            const password = String(fd.get('password') || '');

            const res = await fetch('/auth/signin', {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password }),
            });

            const json = await res.json().catch(() => ({}));
            if (!res.ok) {
                const msg = (json && json.messages && json.messages[0]) ? json.messages[0] : '로그인 실패';
                showToast(msg);
                return;
            }

            // 로그인 성공 -> owner 메인
            location.href = '/owner';
        });
    })();
</script>
