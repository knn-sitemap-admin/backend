<div class="auth">
    <div class="auth__panel auth__panel--wide">
        <div class="auth__head">
            <div class="auth__title">RESET PASSWORD</div>
            <div class="auth__sub">토큰 방식 비밀번호 재설정</div>
        </div>

        <div class="split">
            <div class="split__col">
                <div class="section-title">토큰으로 재설정</div>
                <form class="form" id="reset-form">
                    <label class="field">
                        <div class="field__label">Email</div>
                        <input class="input" type="email" name="email" placeholder="user@company.com" required />
                    </label>

                    <label class="field">
                        <div class="field__label">New Password</div>
                        <input class="input" type="password" name="newPassword" placeholder="••••••••" required />
                    </label>

                    <label class="field">
                        <div class="field__label">Bootstrap Token</div>
                        <input class="input" type="text" name="token" placeholder="x-bootstrap-token" required />
                    </label>

                    <button class="btn btn--primary" type="submit">재설정</button>
                    <div class="hint">API: <span class="kbd">/auth/admin/reset-password-with-token</span></div>
                </form>
            </div>

            <div class="split__col">
                <div class="section-title">안내</div>
                <div class="info">
                    <div class="info__p">- 토큰은 헤더 <span class="kbd">x-bootstrap-token</span> 으로 전송됩니다.</div>
                    <div class="info__p">- 운영에서는 토큰 노출 위험 때문에 접근 제한을 권장합니다.</div>
                    <div class="info__p">- 다음 단계에서 “로그인된 어드민이 직원 비번 강제변경” UI도 여기 붙이면 됩니다.</div>
                </div>

                <div style="margin-top:14px;">
                    <a class="btn btn--ghost" href="/owner/login">로그인으로</a>
                    <a class="btn btn--ghost" href="/owner">메인으로</a>
                </div>
            </div>
        </div>

        <div class="toast" id="toast" aria-hidden="true"></div>
    </div>
</div>

<script>
    (function () {
        const form = document.getElementById('reset-form');
        const toast = document.getElementById('toast');

        function showToast(msg) {
            toast.textContent = msg;
            toast.setAttribute('aria-hidden', 'false');
            toast.classList.add('is-open');
            setTimeout(() => toast.classList.remove('is-open'), 2600);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const fd = new FormData(form);
            const email = String(fd.get('email') || '');
            const newPassword = String(fd.get('newPassword') || '');
            const token = String(fd.get('token') || '');

            const res = await fetch('/auth/admin/reset-password-with-token', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                    'x-bootstrap-token': token,
                },
                body: JSON.stringify({ email, newPassword }),
            });

            const json = await res.json().catch(() => ({}));
            if (!res.ok) {
                const msg = (json && json.messages && json.messages[0]) ? json.messages[0] : '실패';
                showToast(msg);
                return;
            }
            showToast('비밀번호 재설정 완료');
        });
    })();
</script>
